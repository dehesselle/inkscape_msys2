# SPDX-FileCopyrightText: 2023 Ren√© de Hesselle <dehesselle@web.de>
#
# SPDX-License-Identifier: GPL-2.0-or-later

name: build
on:
  push:
  workflow_dispatch:

jobs:

  build:
    runs-on: windows-2022
    defaults:
      run:
        shell: msys2 {0}
    env:
      CCACHE_DIR: c:/ccache
      CCACHE_MAXSIZE: "500M"
      MSYSTEM: UCRT64
    steps:
      - name: Setup cache
        uses: actions/cache@v5
        with:
          path: ${{ env.CCACHE_DIR }}
          key: ccache
      - name: Setup msys2
        uses: msys2/setup-msys2@v2
        with:
          update: true
          msystem: UCRT64
      - name: Install dependencies
        env:
          PACMAN_OPTIONS: "--needed --noconfirm"
        run: |
          curl https://gitlab.com/inkscape/inkscape/-/raw/master/buildtools/msys2installdeps.sh | bash
      - name: Checkout Inkscape repository
        run: git clone --recurse-submodule --single-branch --depth 1 https://gitlab.com/inkscape/inkscape.git
      - name: Configure
        run: cmake -Bbuild -Sinkscape -G Ninja -DCMAKE_C_COMPILER_LAUNCHER=ccache -DCMAKE_CXX_COMPILER_LAUNCHER=ccache
      - name: Make
        run: ninja -C build
      - name: Create artifact
        run: ninja -C build dist-win-7z
      - name: Upload artifact
        uses: actions/upload-artifact@v6
        with:
          name: inkscape.7z
          path: build/inkscape*.7z
